# FunPay Бот для автоматизации перепродажи

Программа-бот для автоматизации перепродажи товаров на FunPay.com. Работает в фоновом режиме, выполняет парсинг товаров, автоматическое размещение с наценкой и отслеживание продаж.
Telegram - @BIKIShop_bot 


<img width="571" height="743" alt="image" src="https://github.com/user-attachments/assets/9515d6eb-2c4e-4714-bda8-d5a76b69296c" />


## Возможности

- ✅ Авторизация в FunPay через golden_key
- ✅ Локальная база данных SQLite для хранения товаров
- ✅ Парсинг товаров из выбранных категорий FunPay
- ✅ Автоматическое размещение товаров с наценкой
- ✅ Отслеживание продаж и автоматическое обновление статусов
- ✅ Автообновление базы данных по расписанию
- ✅ Логирование всех операций

## Установка

1. Установите Python 3.8 или выше

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Настройка

1. Откройте файл `config.ini`

2. Получите `golden_key`:
   - Войдите в свой аккаунт FunPay через браузер
   - Откройте инструменты разработчика (F12)
   - Перейдите во вкладку Application/Storage → Cookies
   - Найдите cookie с именем `golden_key`
   - Скопируйте его значение

3. Вставьте `golden_key` в `config.ini`:
```ini
[funpay]
golden_key = ваш_золотой_ключ_здесь
```

4. Настройте параметры:
   - `markup_percent` - процент наценки на товары (например, 10 = +10%)
   - `parsing_interval` - интервал обхода категорий в секундах
   - `order_check_interval` - интервал проверки заказов в секундах
   - `placement_interval` - интервал размещения товаров в секундах
   - `auto_update_interval_hours` - интервал автообновления базы в часах
   - `request_delay` - задержка между запросами при парсинге (рекомендуется 2+ секунды)

5. Добавьте URL категорий для парсинга в секцию `[categories]`:
```ini
[categories]
category1 = https://funpay.com/lots/123/
category2 = https://funpay.com/lots/456/
```
   Можно добавить любое количество категорий.

## Запуск

### Проверка подключения (рекомендуется перед первым запуском)

```bash
python test_connection.py
```

Этот скрипт проверит:
- Наличие и корректность `golden_key`
- Установку библиотеки FunPayAPI
- Подключение к FunPay
- Возможность получения данных

### Запуск бота

```bash
python main.py
```

Программа будет работать в фоновом режиме. Все события записываются в файл `bot.log`.

Для остановки нажмите `Ctrl+C`.

## Структура проекта

```
.
├── main.py              # Основной файл с главным циклом
├── database.py          # Модуль для работы с SQLite
├── funpay_client.py     # Модуль для работы с FunPay API
├── parser.py            # Модуль для парсинга товаров
├── placement.py         # Модуль для размещения товаров
├── order_tracker.py     # Модуль для отслеживания заказов
├── config.ini           # Файл конфигурации
├── requirements.txt     # Зависимости проекта
├── bot.log             # Файл логов (создается автоматически)
└── funpay_bot.db       # База данных SQLite (создается автоматически)
```

## База данных

База данных SQLite хранит следующую информацию о товарах:
- `id` - уникальный идентификатор
- `category` - категория товара
- `name` - название товара
- `description` - описание
- `original_price` - исходная цена
- `my_price` - моя цена (с наценкой)
- `original_link` - ссылка на оригинальное объявление
- `status` - статус ("активен", "продан", "скрыт")
- `funpay_lot_id` - ID лота на FunPay (если размещен)
- `created_at` - дата создания записи
- `updated_at` - дата последнего обновления

## Важные замечания

⚠️ **Внимание**: FunPay не имеет официального публичного API. Используются неофициальные библиотеки и парсинг.

⚠️ **Рекомендации**:
- Не устанавливайте слишком маленькие интервалы парсинга, чтобы не нагружать сайт
- Регулярно проверяйте логи на наличие ошибок
- Делайте резервные копии базы данных

## Решение проблем

### Ошибка "FunPayAPI не установлена"
```bash
pip install FunPayAPI
```
Если библиотека не найдена на PyPI, попробуйте альтернативные варианты:
- `FunPayNexusAPI`
- Или используйте только парсинг через `parser.py`

### Ошибка авторизации
- Проверьте правильность `golden_key` в `config.ini`
- Убедитесь, что токен не истек (может потребоваться обновить)
- Токен может быть связан с сессией браузера - обновите его при необходимости

### Товары не парсятся
- Проверьте правильность URL категорий
- Структура HTML FunPay может измениться - потребуется обновить парсер в `parser.py`
- Проверьте логи на наличие ошибок
- Увеличьте `request_delay` в конфигурации

### Товары не размещаются
- Проверьте, что у вас есть права на создание лотов в выбранных категориях
- Убедитесь, что `funpay_client.py` правильно использует API
- Проверьте логи на ошибки создания лотов

### База данных не обновляется
- Проверьте права на запись в директорию проекта
- Убедитесь, что файл базы данных не заблокирован другим процессом

## Лицензия

Проект создан в образовательных целях. Используйте на свой страх и риск.

